Left, setTimeLeft] = useState(timerCfg.seconds || 0);

            useEffect(() => {
                if (!hasTimer) return;
                setTimeLeft(timerCfg.seconds); // reset při načtení hry
            }, [hasTimer, timerCfg.seconds]);

            useEffect(() => {
                if (!hasTimer || timeLeft <= 0) return;
                const id = setInterval(() => setTimeLeft(t => t - 1), 1000);
                return () => clearInterval(id);
            }, [hasTimer, timeLeft]);

            useEffect(() => {
                if (!hasTimer || timeLeft > 0) return;
                if (currentId === loseId) return;   // ← nepadat do smyčky
                if (loseId) {
                    setCurrentId(loseId);
                } else {
                    alert("⏰ Čas vypršel! Zkus to znovu.");
                    setCurrentId(start);
                    setSolvedByStep({});
                    setTimeLeft(timerCfg.seconds || 0);
                }
            }, [hasTimer, timeLeft, currentId, loseId, start, timerCfg.seconds]);

            const page = pagesById[currentId];
            const currentIndex = Math.max(0, navSteps.findIndex(s=>s.id===currentId));

            function onResolve(success) {
                const next = success ? page?.next_on_success : page?.next_on_fail;
                if (success) {
                    setSolvedByStep(s => ({ ...s, [currentId]: true }));
                    if (hasTimer && currentId === loseId) setTimeLeft(timerCfg.seconds || 0);
                }
                if (next) {
                    setCurrentId(next);
                } else {
                    const idx = game.pages.findIndex(p => p.id === currentId);
                    const np = game.pages[idx + 1];
                    if (np) setCurrentId(np.id);
                    else setGameCompleted(true);
                    return;
                }
            }

            const handleStepClick = (targetId) => {
                const idx = navSteps.findIndex(s=>s.id===targetId);
                if (idx>-1 && idx<=currentIndex) setCurrentId(targetId);
            };
            
            if (!page) {
                return (
                    <div className="mx-auto max-w-[900px] min-h-screen text-slate-800 p-6">
                        <div className="text-red-600">Neplatné ID stránky: {currentId}</div>
                    </div>
                );
            }
            
            if (gameCompleted) {
                return (
                    <div className="mx-auto max-w-[900px] min-h-screen text-slate-800 flex items-center justify-center">
                        <div className="text-center space-y-6 bg-white/80 backdrop-blur-xl rounded-3xl p-8 shadow-2xl">
                            <div className="text-8xl animate-bounce">🎉</div>
                            <h1 className="text-5xl font-bold text-emerald-600 animate-pulse">Gratulujeme!</h1>
                            <p className="text-2xl text-slate-700">Úspěšně jste dokončili escape game!</p>
                            <div className="flex justify-center space-x-4 text-4xl">
                                <span className="animate-bounce">🏆</span>
                                <span className="animate-bounce">⭐</span>
                                <span className="animate-bounce">🎊</span>
                                <span className="animate-bounce">✨</span>
                            </div>
                            <button
                