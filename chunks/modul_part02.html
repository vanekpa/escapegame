                        : "bg-slate-300/60 text-slate-700 cursor-not-allowed";
                            return (
                                <button
                                    key={s.id}
                                    type="button"
                                    onClick={() => clickable && onStepClick?.(s.id)}
                                    className={`px-3 py-1.5 rounded-full text-sm font-bold flex items-center gap-1 shadow ${cls}`}
                                >
                                    <span>{ICONS[s.iconKey] || "üîí"}</span>
                                    <span className="hidden sm:inline">{s.iconKey}</span>
                                </button>
                            );
                        })}

                        {/* mezera a timer napravo */}
                        <div className="ml-auto" />
                        {showTimer && (
                            <div className={`px-3 py-1.5 rounded-full text-sm font-bold shadow
                                             ${warn ? "bg-rose-500 text-white animate-pulse"
                                                    : "bg-slate-800 text-white/95"}`}>
                                ‚è∞ {mm}:{ss}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Bottom Dock Component
        function BottomDock({ children, size="compact" }) {
            const cls = size === "expanded"
                ? "max-h-[62vh] sm:max-h-[55vh]"   // v√≠c m√≠sta pro velk√© kl√°vesnice
                : "max-h-[42vh] sm:max-h-[36vh]";
            return (
                <div className="fixed bottom-0 left-0 right-0 z-20">
                    <div className={`mx-auto max-w-[1000px] ${cls} overflow-y-auto
                        rounded-t-[26px] bg-white/80 backdrop-blur-md
                        shadow-[0_-20px_60px_rgba(0,0,0,.25)] border-t border-black/10 p-4`}>
                        {children}
                    </div>
                </div>
            );
        }

        // Info Bubble Component
        function InfoBubble({ info, onContinue }) {
            const i = info || {};
            const desc = i.description || i.text || i.story || "";
            return (
                <div className="max-w-xl w-full bg-black/45 backdrop-blur rounded-2xl p-5 text-white text-center">
                    {i.title && <h1 className="text-2xl font-semibold mb-2">{i.title}</h1>}
                    {desc && <p className="text-base opacity-90">{desc}</p>}
                    <button
                        onClick={onContinue}
                        className="mt-4 inline-flex px-6 py-2 rounded-lg bg-emerald-500 hover:bg-emerald-600"
                    >
                        Pokraƒçovat
                    </button>
                </div>
            );
        }

        // Scene: obr√°zek v≈ædy cel√Ω (letterbox), p≈ôep√≠n√°n√≠ v√≠ce obr√°zk≈Ø z background_imgs
        function Scene({ page, assets, onResolve, solved, dockSize = "compact" }) {
            const BASE = "./";
            const resolveImg = (p) => (p && !/^https?:\/\//.test(p) ? BASE + p : p);

            const imgs = (page?.ui?.background_imgs?.length
                ? page.ui.background_imgs
                : page?.ui?.background_img ? [page.ui.background_img] : []
            ).map(resolveImg);

            const [idx, setIdx] = React.useState(0);
            const cur = imgs[idx] || null;

            // --- nov√© ovladaƒçe vzhledu z JSON ---
            const isInfo = page?.type === "info";
            const fullBleed = !!page?.ui?.full_bleed && isInfo;
            const darken = typeof page?.ui?.darken === "number"
                ? page.ui.darken
                : (isInfo ? 0.05 : 0.25); // defaulty

            // v√Ω≈°ka "pl√°tna"
            const VIEW_H = fullBleed ? "82vh" : "60vh";

            // opo≈ædƒõn√© odhalen√≠ obsahu (bublina + dock)
            const revealMs = page?.ui